import PluginBase from '@layer0/core/plugins/PluginBase';
import ResponseWriter from '@layer0/core/router/ResponseWriter';
import RouteGroup from '@layer0/core/router/RouteGroup';
import Router from '@layer0/core/router/Router';
export default class NextRoutes extends PluginBase {
    private nextRouteGroupName;
    private nextRootDir;
    private pagesDir;
    private pagesDirRelative;
    private router?;
    private rewrites?;
    private redirects?;
    private routesManifest;
    private distDir;
    private defaultLocale?;
    private renderMode;
    type: string;
    /**
     * Provides next registered routes to router
     * @param nextRootDir The root directory for the Next.js app
     */
    constructor(nextRootDir?: string);
    /**
     * Attempt to get rewrites and redirects from routes-manifest.json in production.
     */
    private loadRewrites;
    /**
     * Returns the contents of pages-manifest.json
     */
    private getPagesManifest;
    /**
     * Returns the contents of prerender-manifest.json
     */
    private getPrerenderManifest;
    /**
     * Attempt to get rewrites and redirects from the next config in development.
     */
    private loadRewritesInDev;
    /**
     * Called when plugin is registered
     * @param router The router to which the plugin has been added.
     */
    onRegister(router: Router): void;
    /**
     * Update routes
     */
    private updateRoutes;
    /**
     * Adds next routes to route group.
     * @param group The RouteGroup to which Next.js routes should be added.
     */
    private addNextRoutesToGroup;
    /**
     * Adds the route for server assets such as the middleware manifest
     * @param group
     */
    private addMiddlewareManifest;
    /**
     * Creates a Layer0 RouteCriteria from path and has attributes found in rewrites in redirects
     * in next.config.js.
     * @param path The path pattern
     * @param has Has elements from next.config.js rewrites and redirects.
     * @returns
     */
    private createRouteCriteria;
    /**
     * Find an existing route that would match a request with destination as the path - we will run its handler when
     * the request's path matches the rewrite source.
     * @param group The route group
     * @param source The source URL
     * @param has Any has elements
     * @param destination The destination URL
     */
    private addRewrite;
    /**
     * Finds a backend in layer0.config.js that has the same hostname as the specified rewrite destination URL.
     * @param urlStr
     * @returns
     */
    private backendForDestination;
    private addRewrites;
    /**
     * Adds rewrites and redirects from next.config.js
     * @param group The group to which to add redirect routes
     */
    private addRedirects;
    /**
     * Adds routes for all pages and corresponding data in development
     * @param group The group to which to add page routes
     */
    private addPagesInDev;
    /**
     * Adds routes for react components and API handlers
     * @param group The group to which to add page routes
     */
    private addPagesInProd;
    /**
     * Returns true if the specified page was statically rendered at build time (no getServerSideProps or getInitialProps)
     * @param prerenderManifest The prerender-manifest.json file
     * @param pagesManifest the pages-manifest.json file
     * @param page The page key
     * @returns
     */
    private isPrerendered;
    /**
     * Removes the locale part from the start of path
     * @param path E.g /en-US/p/[id]
     * @returns the path minus the locale, e.g /p/[id]
     */
    private removeLocale;
    /**
     * Automatically configure prerendering to pull all SSG pages into the edge cache.
     * This only needs to be done during a production build.
     */
    private addPrerendering;
    /**
     * Production route handler for all dynamic HTML and JSON requests (SSR and SSG).
     * @param page The next.js page to render
     */
    private createSSRHandler;
    /**
     * Creates a handler for SSG pages that can be optionally configured with fallback: trlayer0dfdue
     * @param relativeAssetPath The asset path relative to .next/serverless
     * @param options
     */
    private createSSGHandler;
    /**
     * Renders the the 404 page.
     *
     * Example:
     *
     * ```js
     *  import { nextRoutes } from '@layer0/next'
     *  import { Router } from '@layer0/core/router'
     *
     *  export default new Router()
     *    .get('/some/missing/page', (res) => {
     *      nextRoutes.render404(res)
     *    })
     *    .use(nextRoutes)
     * ```
     *
     * @param res The ResponseWriter to use to send the response
     */
    render404(res: ResponseWriter): Promise<void>;
    private _render404;
    /**
     * Adds routes for static assets, including /public and /.next/static
     * @param group The RouterGroup to which asset routes should be added
     */
    private addAssets;
    /**
     * Adds routes for image-optimizer
     * @param group The RouterGroup to which image optimizer routes should be added
     */
    addImageOptimizerRoutes(group: RouteGroup): void;
}
/**
 * Sort static routes before dynamic routes
 * @param pages Page paths
 * @param routesManifest The routes manifest generated by Next's build
 */
export declare function sortRoutes(pages: string[], routesManifest: any): string[];
